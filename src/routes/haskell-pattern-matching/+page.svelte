<!-- auto-generated by QWER -->
<script lang="ts">
  /* eslint-disable @typescript-eslint/ban-ts-comment */
  // @ts-nocheck
  import Post from '$lib/layouts/post.svelte';
  import ImgZoom from '$lib/components/image_zoom.svelte';
  import Video from '$lib/components/video.svelte';
  import CodeCopy from '$lib/components/code_copy.svelte';
  import InfoBox from '$lib/components/info_box.svelte';
</script>

<Post>
  <article slot="post_content">
    <h1 id="haskell-cong2-ru4-men2-dao4-fang4-qi4-pattern-matching">
      <a href="#haskell-cong2-ru4-men2-dao4-fang4-qi4-pattern-matching">Haskell 從入門到放棄 - pattern matching</a>
    </h1>
    <p>
      許多語言都有的概念「pattern matching」，在 Haskell 中我們可以在定義 function 時，直接讓 function
      輸入（匹配）到特定值時就給出相應的輸出。
    </p>
    <h1 id="ji1-ben3-shi3-yong4"><a href="#ji1-ben3-shi3-yong4">基本使用</a></h1>
    <p>舉個例子我想寫一個 function ，如果讀到特定字元就輸出特定字串的話我可以這樣寫：</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'a'</span> <span class="token operator">=</span> <span class="token string">"Apple"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'b'</span> <span class="token operator">=</span> <span class="token string">"Banana"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'c'</span> <span class="token operator">=</span> <span class="token string">"Candy"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'a'</span> <span class="token comment">-- "Apple"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'b'</span> <span class="token comment">-- "Banana"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'c'</span> <span class="token comment">-- "Candy"</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>但如果我們超出我們所規定的 pattern 的話</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'d'</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">"<span class="token operator">***</span> <span class="token constant">Exception</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token hvariable">interactive</span><span class="token operator">>:</span><span class="token number">116</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">18</span><span class="token operator">:</span> <span class="token constant">Non</span><span class="token operator">-</span><span class="token hvariable">exhaustive</span> <span class="token hvariable">patterns</span> <span class="token keyword">in</span> <span class="token hvariable">function</span> <span class="token hvariable">word</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      所以通常還是需要定義一個通用的 pattern 這樣才能避免 runtime 的錯誤，可以使用 <code class="inline-code-block">
        _
      </code>
      來代表「任何值」
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token string">"Unknown"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">word</span> <span class="token char string">'d'</span> <span class="token comment">-- "Unknown"</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h1 id="shao1-wei1-jin4-jie1-yi1-dian3-dian3">
      <a href="#shao1-wei1-jin4-jie1-yi1-dian3-dian3">稍微進階一點點</a>
    </h1>
    <p>我們也可以用 pattern matching 來達成之前遞迴加總 List 的元素</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Int</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token constant">Int</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token hvariable">xs</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token builtin">print</span> <span class="token punctuation">(</span><span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- 15 </span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      我們先定義了
      <code class="inline-code-block">sumList [] = 0</code>
      意思是
      <code class="inline-code-block">sumList</code>
      的輸入為
      <code class="inline-code-block">[]</code>
      時會回傳
      <code class="inline-code-block">0</code>
      ，而當輸入不是
      <code class="inline-code-block">[]</code>
      時就是會到下一行
      <code class="inline-code-block">sumList &lpar;x:xs&rpar; = x + sumList xs</code>
    </p>
    <p>
      這個 expression 第一次看到時會感到有點疑惑，但只要先記得 <code class="inline-code-block">[1,2,3]</code>
      就是
      <code class="inline-code-block">1:[2:3]</code>
      （精確來說是
      <code class="inline-code-block">1:2:3:[]</code>
      ) ，那這邊我們就能用
      <code class="inline-code-block">&lpar;x:xs&rpar;</code>
      的形式去拿出 List 中的第一個元素及剩餘的 List 。 然後我就把第一項與放入
      <code class="inline-code-block">sumList</code>
      的剩餘 List 相加即可。
    </p>
    <p>過程會像是：</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token number">1</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h1 id="as-pattern"><a href="#as-pattern">as-pattern</a></h1>
    <p>
      在 Haskell 中還有兩個蠻常搭配 pattern matching 的語法 <code class="inline-code-block">@</code>
      及
      <code class="inline-code-block">_</code>
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">concatFirstElement</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token constant">String</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">concatFirstElement</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Empty list, whoops!"</span> </div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">concatFirstElement</span> <span class="token builtin">all</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"The first element of the list "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token builtin">all</span> <span class="token operator">++</span> <span class="token string">" is "</span> <span class="token operator">++</span> <span class="token hvariable">x</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token builtin">print</span> <span class="token punctuation">(</span><span class="token hvariable">concatFirstElement</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- "Empty list, whoops!"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token builtin">print</span> <span class="token punctuation">(</span><span class="token hvariable">concatFirstElement</span> <span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">,</span><span class="token string">"bar"</span><span class="token punctuation">,</span><span class="token string">"baz"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- "The first element of the list [\"foo\",\"bar\",\"baz\"] is foo"</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      我們先從 <code class="inline-code-block">&lpar;x:_&rpar;</code>
      開始看，這裡意思就是我們當我們匹配到一個 List 後，只會用到
      <code class="inline-code-block">x</code>
      而
      <code class="inline-code-block">x</code>
      所串接的 List 我並不在乎，跟前面的
      <code class="inline-code-block">x:xs</code>
      來比較的話，是因為在
      <code class="inline-code-block">concatFirstElement</code>
      並不會使用到
      <code class="inline-code-block">xs</code>
      所以可以用
      <code class="inline-code-block">_</code>
      來避免宣告一個不會用的值。
    </p>
    <p>
      而 <code class="inline-code-block">all@&lpar;x:_&rpar;</code>
      就是記住這個 pattern 的 reference ，也就是說
      <code class="inline-code-block">all</code>
      就是
      <code class="inline-code-block">&lpar;x:_&rpar;</code>
      這個 List ，如果不使用
      <code class="inline-code-block">@</code>
      的話，我還是得改為
      <code class="inline-code-block">x:xs</code>
      來讓我可以表示出整個 List 。
    </p>
    <p>也就是會變成這樣：</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">concatFirstElement</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"The first element of the list "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">++</span> <span class="token string">" is "</span> <span class="token operator">++</span> <span class="token hvariable">x</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h1 id="guard"><a href="#guard">Guard</a></h1>
    <p>
      前面的用法只能用在如果是遇到「特定的值」或「結構」時就做什麼行為，但如果是要做大於小於之類的比較或者是有多個參數要一起參與判斷式的組成，那感覺就不太夠用了。
    </p>
    <p>這時我們可以使用 Guard，我們先來寫了一個 function 來判斷三個邊長是否可以構成一個合法的三角型</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">calcTriangle</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">String</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">calcTriangle</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token hvariable">c</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">b</span> <span class="token operator">&lt;=</span> <span class="token hvariable">c</span> <span class="token operator">||</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">c</span> <span class="token operator">&lt;=</span> <span class="token hvariable">b</span> <span class="token operator">||</span> <span class="token hvariable">b</span> <span class="token operator">+</span> <span class="token hvariable">c</span> <span class="token operator">&lt;=</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token string">"Invalid"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">b</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">b</span> <span class="token operator">==</span> <span class="token hvariable">c</span> <span class="token operator">=</span> <span class="token string">"Equilateral"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">b</span> <span class="token operator">||</span> <span class="token hvariable">b</span> <span class="token operator">==</span> <span class="token hvariable">c</span> <span class="token operator">||</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">c</span> <span class="token operator">=</span> <span class="token string">"Isosceles"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token string">"Scalene"</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Guard 的用法很簡單，只要用 | 並在後面加上一個最後會回傳 <code class="inline-code-block">Bool</code>
      的 expression 以及match到後要回傳的 expression ，然後依序從上到下如果失敗就會往下繼續 match 。
    </p>
    <p>
      首先我們用三角形任意兩邊一定大於第三邊來當作判斷，如果成立為 <code class="inline-code-block">True</code>
      就會回傳
      <code class="inline-code-block">&quot;Invalid&quot;</code>
      ，如果不是就會接到下一個 guard ，接下來我們來判斷如果三邊相等那就代表他為正三角形所以回傳
      <code class="inline-code-block">&quot;Equilateral&quot;</code>
      ，如果還不是就會繼續到下一個 guard ，以此類推直到最後的
      <code class="inline-code-block">otherwise</code>
      。
    </p>
    <p>
      <code class="inline-code-block">otherwise</code>
      就是
      <code class="inline-code-block">True</code>
      ，意思就是一定會執行右邊的 expression ，通常就是放在最後面有點類似其他語言的
      <code class="inline-code-block">switch case</code>
      的
      <code class="inline-code-block">default</code>
      之類的用途。但如果沒有提供
      <code class="inline-code-block">otherwise</code>
      且最後沒有匹配到任何一個 guard ，那跟一班的 pattern matching 一樣最後會拋出錯誤。
    </p>
    <h1 id="where"><a href="#where">Where</a></h1>
    <p>
      上面的程式感覺還是有點羅嗦，有什麼辦法可以簡化重複的 pattern 嗎？這時候我們可以使用 <code
        class="inline-code-block">
        where
      </code>
      幫定義我們需要重複的 expression。
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">calcTriangle'</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">String</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">calcTriangle'</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token hvariable">c</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">b</span> <span class="token operator">&lt;=</span> <span class="token hvariable">c</span> <span class="token operator">||</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">c</span> <span class="token operator">&lt;=</span> <span class="token hvariable">b</span> <span class="token operator">||</span> <span class="token hvariable">b</span> <span class="token operator">+</span> <span class="token hvariable">c</span> <span class="token operator">&lt;=</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token string">"Invalid"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">abEq</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">bcEq</span> <span class="token operator">=</span> <span class="token string">"Equilateral"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">abEq</span> <span class="token operator">||</span> <span class="token hvariable">bcEq</span> <span class="token operator">||</span> <span class="token hvariable">acEq</span> <span class="token operator">=</span> <span class="token string">"Isosceles"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token string">"Scalene"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">where</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">abEq</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">b</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">bcEq</span> <span class="token operator">=</span> <span class="token hvariable">b</span> <span class="token operator">==</span> <span class="token hvariable">c</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">acEq</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">c</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <code class="inline-code-block">where</code>
      的用法就是放在 | 的後面定義名稱及值 ，所以我們可以
      <code class="inline-code-block">a == b</code>
      等等的布林運算定義成另外一個名稱，然後原本的
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token operator">|</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">b</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">b</span> <span class="token operator">==</span> <span class="token hvariable">c</span> <span class="token operator">=</span> <span class="token string">"Equilateral"</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>就可以變成</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token operator">|</span> <span class="token hvariable">abEq</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">bcEq</span> <span class="token operator">=</span> <span class="token string">"Equilateral"</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      讓我們在使用 pattern matching 時增加整體的可讀性，且 <code class="inline-code-block">where</code>
      中所綁定的名稱只在這個 function 也就是
      <code class="inline-code-block">calcTriangle&#39;</code>
      裡才有用。
    </p>
    <p>
      除了綁定數值以外，
      <code class="inline-code-block">where</code>
      也可以用來綁定 function
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">calcTriangle''</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">String</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">calcTriangle''</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token hvariable">c</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">isInvalid</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token hvariable">c</span> <span class="token operator">||</span> <span class="token hvariable">isInvalid</span> <span class="token hvariable">a</span> <span class="token hvariable">c</span> <span class="token hvariable">b</span> <span class="token operator">||</span> <span class="token hvariable">isInvalid</span> <span class="token hvariable">b</span> <span class="token hvariable">c</span> <span class="token hvariable">a</span><span class="token operator">=</span> <span class="token string">"Invalid"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">abEq</span> <span class="token operator">&amp;&amp;</span> <span class="token hvariable">bcEq</span> <span class="token operator">=</span> <span class="token string">"Equilateral"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token hvariable">abEq</span> <span class="token operator">||</span> <span class="token hvariable">bcEq</span> <span class="token operator">||</span> <span class="token hvariable">acEq</span> <span class="token operator">=</span> <span class="token string">"Isosceles"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token string">"Scalene"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">where</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">abEq</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">b</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">bcEq</span> <span class="token operator">=</span> <span class="token hvariable">b</span> <span class="token operator">==</span> <span class="token hvariable">c</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">acEq</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">c</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">isInvalid</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token hvariable">z</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">y</span> <span class="token operator">&lt;=</span> <span class="token hvariable">z</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      我們可以把 <code class="inline-code-block">a + b &lt;= c</code>
      這類的運算改用
      <code class="inline-code-block">where</code>
      來定義成一個 function ，雖然在這裡看不出有太多的差異或者有什麼理由一定要這樣寫，但假設我們今天有一個很小的 function
      想要抽出原本的 expression 但又不需要寫成全域的 function 我們也可以用
      <code class="inline-code-block">where</code>
      來協助我們達成這件事情。
    </p>
    <p>拿我們前幾天的 List comprehension 的例子舉例：</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">[</span><span class="token hvariable">email</span> <span class="token operator">|</span> <span class="token hvariable">email</span> <span class="token operator">&lt;-</span> <span class="token hvariable">emailList</span><span class="token punctuation">,</span> <span class="token builtin">elem</span> <span class="token char string">'@'</span> <span class="token hvariable">email</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin">elem</span> <span class="token char string">'.'</span> <span class="token hvariable">email</span> <span class="token punctuation">]</span> </div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      原本我們有一個 List comprehension 然後他的限制條件是判斷 <code class="inline-code-block">email</code>
      裡有無
      <code class="inline-code-block">@</code>
      且
      <code class="inline-code-block">.</code>
      但假設我們想把這個判斷抽出來也可以使用
      <code class="inline-code-block">where</code>
      來達成
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">filterValidEmail</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">filterValidEmail</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> </div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">[</span><span class="token hvariable">email</span> <span class="token operator">|</span> <span class="token hvariable">email</span> <span class="token operator">&lt;-</span> <span class="token hvariable">xs</span><span class="token punctuation">,</span>  <span class="token hvariable">isValid</span> <span class="token hvariable">email</span> <span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">where</span> </div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">isValid</span> <span class="token hvariable">email</span> <span class="token operator">=</span> <span class="token char string">'@'</span> <span class="token operator">&#96;elem&#96;</span> <span class="token hvariable">email</span> <span class="token operator">&amp;&amp;</span>  <span class="token char string">'.'</span> <span class="token operator">&#96;elem&#96;</span> <span class="token hvariable">email</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      這裡可以看到我們使用 <code class="inline-code-block">where</code>
      來將
      <code class="inline-code-block">isValid</code>
      的邏輯抽出來，然後我再把原本的限制條件改為使用
      <code class="inline-code-block">isValid</code>
    </p>
    <p>
      總結來說 <code class="inline-code-block">where</code>
      有點像是局部變數的概念，我們可以將某些數值或者 function 固定在某個 scope 有作用而已。
    </p>
    <blockquote>
      <p>雖然沒有特別提到，但在 Haskell 中 function 也是一種變數。</p>
    </blockquote>
    <h1 id="let"><a href="#let">Let</a></h1>
    <p>
      說到區域變數，也許有人會疑惑那跟 <code class="inline-code-block">let</code>
      又差在哪裡？
    </p>
    <p>
      我們先把上面的程式碼改為用 <code class="inline-code-block">let in</code>
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">filterValidEmail'</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">filterValidEmail'</span> <span class="token hvariable">xs</span> <span class="token operator">=</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token keyword">let</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token hvariable">isValid</span> <span class="token hvariable">email</span> <span class="token operator">=</span> <span class="token char string">'@'</span> <span class="token operator">&#96;elem&#96;</span> <span class="token hvariable">email</span> <span class="token operator">&amp;&amp;</span> <span class="token char string">'.'</span> <span class="token operator">&#96;elem&#96;</span> <span class="token hvariable">email</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token keyword">in</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">[</span><span class="token hvariable">email</span> <span class="token operator">|</span> <span class="token hvariable">email</span> <span class="token operator">&lt;-</span> <span class="token hvariable">xs</span><span class="token punctuation">,</span> <span class="token hvariable">isValid</span> <span class="token hvariable">email</span><span class="token punctuation">]</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      跟之前所介紹的一樣 <code class="inline-code-block">let</code>
      綁定的名稱只在
      <code class="inline-code-block">in</code>
      裡面有作用，
      <code class="inline-code-block">let</code>
      與
      <code class="inline-code-block">where</code>
      的根本差異是
      <code class="inline-code-block">in</code>
      後面是接一個 expression 且
      <code class="inline-code-block">let</code>
      可以在任何地方使用
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token comment">-- ghci </span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">foo</span> <span class="token operator">=</span> <span class="token keyword">let</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token number">200</span> <span class="token keyword">in</span> <span class="token hvariable">a</span> <span class="token operator">+</span><span class="token number">1</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">foo</span> <span class="token comment">-- 201</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">foo</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">let</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token number">200</span> <span class="token keyword">in</span> <span class="token hvariable">a</span><span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">,</span> <span class="token number">202</span><span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">foo</span> <span class="token comment">-- [201,202]</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      那至於該選擇 <code class="inline-code-block">let</code>
      還是
      <code class="inline-code-block">where</code>
      呢？只能說看習慣與場合，但多數情況**「我個人認為」**
      <code class="inline-code-block">where</code>
      比較好讀一點點
    </p>
    <h1 id="case"><a href="#case">Case</a></h1>
    <p>
      <code class="inline-code-block">case</code>
      使用其實就真的很像其他語言的
      <code class="inline-code-block">switch case</code>
      一樣 ，我們
      <code class="inline-code-block">case</code>
      一個值然後根據他的值而執行什麼。
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token operator">::</span> <span class="token constant">Num</span> <span class="token hvariable">a</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token hvariable">a</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">sumList</span> <span class="token hvariable">xs</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList'</span> <span class="token operator">::</span> <span class="token constant">Num</span> <span class="token hvariable">a</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token hvariable">a</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">sumList'</span> <span class="token hvariable">list</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">list</span> <span class="token keyword">of</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token number">0</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">sumList'</span> <span class="token hvariable">xs</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      那這樣 <code class="inline-code-block">sumList</code>
      跟
      <code class="inline-code-block">sumList&#39;</code>
      有什麼差？答案就是「沒差」，我們在 function 使用的 pattern matching 就只是
      <code class="inline-code-block">case</code>
      的語法糖而已。
    </p>
    <p>
      但 <code class="inline-code-block">case</code>
      看的出來也是一種 expression 所以我們一樣能在任何地方，所以也能這樣做
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-haskell">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token hvariable">foo</span> <span class="token hvariable">x</span> <span class="token operator">=</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">[</span><span class="token keyword">case</span> <span class="token hvariable">x</span> <span class="token keyword">of</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token char string">'a'</span> <span class="token operator">-></span> <span class="token number">10</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token char string">'b'</span> <span class="token operator">-></span> <span class="token number">11</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token char string">'c'</span> <span class="token operator">-></span> <span class="token number">12</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token char string">'d'</span> <span class="token operator">-></span> <span class="token number">13</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token char string">'e'</span> <span class="token operator">-></span> <span class="token number">14</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token char string">'f'</span> <span class="token operator">-></span> <span class="token number">15</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token hvariable">_</span> <span class="token operator">-></span> <span class="token builtin">error</span> <span class="token string">"Invalid hex digit"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
  </article>
</Post>
